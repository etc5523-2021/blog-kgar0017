---
title: "Bahrain COVID Stats"
output:
  distill::distill_article:
    self_contained: false
---

```{r ,include=FALSE}
library(tidyverse)
library(here)
library(ggplot2)
library(sparkline)
library(DT)
library(kableExtra)
library(gghighlight)
library(plotly)
library (patchwork) 
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
options(scipen = 1e6)
```
```{css ,echo = FALSE}

h1{
  color: red;
  font-size: 50px;
}

h2{
  color: grey;
  font-size: 20px;
}

thead {
  background-color: #006DAE;
  color: white;
}


```

```{r read,include=FALSE}
covid <- read_csv(here::here("data/bahrain-covid-data.csv"))
```
```{r read1,include=FALSE}
covid_bahrain <- covid %>% 
 filter(location == "Bahrain")
```

```{r read2,include=FALSE}
covid_bahrain_1 <- covid_bahrain %>% 
  select(location,date,total_cases,new_cases,new_cases_smoothed,total_deaths,new_deaths,new_deaths_smoothed,new_tests,total_tests,total_vaccinations,people_vaccinated,people_fully_vaccinated,total_boosters,new_vaccinations,new_vaccinations_smoothed,population,population_density,extreme_poverty,cardiovasc_death_rate,diabetes_prevalence,female_smokers,male_smokers,handwashing_facilities,life_expectancy,excess_mortality)

covid_asia <- covid %>% 
  filter(continent == "Asia") %>% 
    select(location,date,total_cases,new_cases,new_cases_smoothed,total_deaths,new_deaths,new_deaths_smoothed,new_tests,total_tests,total_vaccinations,people_vaccinated,people_fully_vaccinated,total_boosters,new_vaccinations,new_vaccinations_smoothed,population,population_density,extreme_poverty,cardiovasc_death_rate,diabetes_prevalence,female_smokers,male_smokers,handwashing_facilities,life_expectancy,excess_mortality)



```


The main dataset is of dimensions **`r dim(covid)`**, whereas that of **India** alone is **`r dim(covid_bahrain)`**.

# Analysis & Findings

## What are the top 5 days with maximum covid cases reported

```{r Q1A,echo=FALSE}
covid_bahrain_1 %>% 
  select(date,total_cases,new_cases,new_tests,total_tests) %>% 
  rename("Date" = date,
         "Total_Cases" = total_cases,
         "New_Cases" = new_cases,
         "New_Tests" = new_tests,
         "Total_Tests" = total_tests) %>% 
   slice_max(New_Cases,n = 5) %>% 
  mutate(Perc_New_Cases = round((New_Cases/New_Tests)*100,2)) %>% 
  kable(caption = "Top 5 days with max no of covid cases in Bahrain") %>% 
  kable_styling(bootstrap_options = c("basic","striped,hover"))
```


```{r Q1B,echo=FALSE}
covid_bahrain_1 %>% 
  select(date,total_cases,new_cases,new_tests,total_tests) %>% 
  rename("Date" = date,
         "Total_Cases" = total_cases,
         "New_Cases" = new_cases,
         "New_Tests" = new_tests,
         "Total_Tests" = total_tests) %>% 
  mutate(Perc_New_Cases = round((New_Cases/New_Tests)*100,2)) %>% 
  slice_max(Perc_New_Cases,n = 5) %>% 
  kable(caption = "Top 5 days with max percetage of new covid cases in Bahrain") %>% 
  kable_styling(bootstrap_options = c("basic","striped,hover"))
```

The table **1** & **2** above tells us that:

*  **29th May,2021** reported maximum new covid cases.
*  **11th March,2020** had a more percentage of new cases reported w.r.t new tests done.

## What are top 5 days with maximum covid vaccinations done ?

```{r}
covid_bahrain_1 %>% 
  select(date,total_vaccinations,new_cases,new_vaccinations) %>% 
  slice_max(new_vaccinations,n = 5) %>% 
  kable(caption = "Top 5 days with max covid vaccinations done") %>% 
  kable_styling(bootstrap_options = c("basic","striped,hover"))
```

## What are top 5 days with maximum deaths due to covid ?

```{r}
covid_bahrain_1 %>% 
  select(date,total_deaths,new_cases,new_deaths) %>% 
  slice_max(new_deaths,n = 5) %>% 
  kable(caption = "Ttop 5 days with maximum deaths due to covid") %>% 
  kable_styling(bootstrap_options = c("basic","striped,hover"))
```

The table **3** above tells us that:

*  **28th june,2021** recorded maximum nnumber of vaccination done across the country.


# Data Story 1 (Wihthin Continent)

```{r read3,include=FALSE}
covid_asia_loc <- covid_asia %>% 
  filter(date == "2021-09-12") %>% 
  slice_max(total_cases,n=5) %>% 
  select(location)

 covid_asia_loc1 <- covid_asia_loc$location
```


```{r}
covid_asia %>% 
   filter((location == "Bahrain" | location %in% covid_asia_loc1) & date == "2021-09-12") %>% 
  ggplot(aes(reorder(location,total_cases),
             total_cases,
             fill = "orange")) +
  geom_col() +
  geom_label(aes(label = total_cases)) +
  theme(legend.position = "none")
```


```{r plt1}

graph1 <- covid_asia %>% 
  filter(location == "Bahrain" | location %in% covid_asia_loc1) %>% 
  separate(date, into = c("Year","Month","Day")) %>% 
  group_by(location,Year,Month) %>% 
  summarise(Mon_new_cases = sum(new_cases)) %>% 
  mutate(Year = as.factor(Year),
         Month = as.numeric(Month)) %>% 
  ggplot(aes(Month,
             Mon_new_cases,
             color = location)) +
  geom_line() +
  scale_x_continuous(breaks = seq(1,12,1)) +
  geom_point() +
  ylab("Total Monthly Cases") +
  ggtitle("Trend of monthly Covid Cases per year") +
  theme_bw() +
#   gghighlight(location == "Bahrain" | location %in% covid_asia_loc1) +
  facet_wrap(~Year) 
ggplotly(graph1)
```

```{r}
graph2 <- covid_asia %>% 
  filter(location == "Bahrain" | location %in% covid_asia_loc1) %>% 
  separate(date, into = c("Year","Month","Day")) %>% 
  group_by(location,Year,Month) %>% 
  summarise(Mon_new_deaths = sum(new_deaths)) %>% 
  mutate(Year = as.factor(Year),
         Month = as.numeric(Month)) %>% 
  ggplot(aes(Month,
             Mon_new_deaths,
             color = location)) +
  geom_line() +
  scale_x_continuous(breaks = seq(1,12,1)) +
  geom_point() +
  ylab("Total Monthly Cases") +
  ggtitle("Trend of monthly Covid Deaths within continent per year") +
  theme_bw() +
#   gghighlight(location == "Bahrain" | location %in% covid_asia_loc1) +
  facet_wrap(~Year) 
ggplotly(graph2)
```


# Data Story 2(Betwee continents)

```{r read4,include=FALSE}
covid_cont_loc <- covid %>% 
  filter(date  == "2021-09-12") %>% 
  group_by(continent) %>% 
  slice_max(total_cases,n = 1) %>% 
  head(6) %>% 
  select(location)


covid_cont_loc1 <- covid_cont_loc$location
```

```{r plt4}
covid %>% 
   filter((location == "Bahrain" | location %in% covid_cont_loc1) & date == "2021-09-12") %>% 
  ggplot(aes(reorder(location,total_cases),
             total_cases,
             fill = "yellow")) +
  geom_col() +
  geom_label(aes(label = total_cases)) +
  theme(legend.position = "none")
```


```{r plt5}

graph3 <- covid %>% 
  filter(location == "Bahrain" | location %in% covid_cont_loc1) %>% 
  separate(date, into = c("Year","Month","Day")) %>% 
  group_by(location,Year,Month) %>% 
  summarise(Mon_new_cases = sum(new_cases)) %>% 
  mutate(Year = as.factor(Year),
         Month = as.numeric(Month)) %>% 
  ggplot(aes(Month,
             Mon_new_cases,
             color = location)) +
  geom_line() +
  scale_x_continuous(breaks = seq(1,12,1)) +
  geom_point() +
  ylab("Total Monthly Cases") +
  ggtitle("Trend of monthly Covid Cases per year") +
  theme_bw() +
#   gghighlight(location == "Bahrain" | location %in% covid_asia_loc1) +
  facet_wrap(~Year) 
ggplotly(graph3)
```


```{r plt6}
graph4 <- covid %>% 
  filter(location == "Bahrain" | location %in% covid_cont_loc1) %>% 
  separate(date, into = c("Year","Month","Day")) %>% 
  group_by(location,Year,Month) %>% 
  summarise(Mon_new_deaths = sum(new_deaths)) %>% 
  mutate(Year = as.factor(Year),
         Month = as.numeric(Month)) %>% 
  ggplot(aes(Month,
             Mon_new_deaths,
             color = location)) +
  geom_line() +
  scale_x_continuous(breaks = seq(1,12,1)) +
  geom_point() +
  ylab("Total Monthly Cases") +
  ggtitle("Trend of monthly Covid Deaths within continent per year") +
  theme_bw() +
#   gghighlight(location == "Bahrain" | location %in% covid_asia_loc1) +
  facet_wrap(~Year) 
ggplotly(graph4)
```


```{r plt7}
covid_2020 <- covid %>% 
  separate(date, into = c("Year","Month","Day")) %>%
  filter(Year == "2020") %>% 
   mutate(new_cases = ifelse(is.na(new_cases),0,new_cases)) %>% 
   group_by(iso_code,location,Month) %>% 
    summarise(Mon_new_cases = sum(new_cases)) %>% 
  rename("covid_2020" = Mon_new_cases)

covid_df_2020 <- covid_2020 %>% 
  inner_join(maps::iso3166, by = c(iso_code = "a3"))

breaks <- pretty(covid_2020$covid_2020)

covid_graph_2020 <- 
  plot_geo(covid_df_2020,
           frame = ~Month) %>% 
  add_trace(locations = ~iso_code,
            z = ~covid_2020,
            color = covid_2020) %>% 
  layout(title = "Trend of Covid Cases worldwide,2020")
covid_graph_2020
```

```{r plt8}

covid_2021 <- covid %>% 
  separate(date, into = c("Year","Month","Day")) %>%
  filter(Year == "2021") %>% 
   mutate(new_cases = ifelse(is.na(new_cases),0,new_cases)) %>% 
   group_by(iso_code,location,Month) %>% 
    summarise(Mon_new_cases = sum(new_cases)) %>% 
  rename("covid_2021" = Mon_new_cases)

covid_df <- covid_2021 %>% 
  inner_join(maps::iso3166, by = c(iso_code = "a3"))

breaks <- pretty(covid_2021$covid_2021)

covid_graph_2021 <- 
  plot_geo(covid_df,
           frame = ~Month) %>% 
  add_trace(locations = ~iso_code,
            z = ~covid_2021,
            color = covid_2021) %>% 
  layout(title = "Trend of Covid Cases worldwide,2021")
covid_graph_2021
```




